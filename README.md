# astrbot_plugin_r_parser

_✨ 全能链接解析器 ✨_  

## 📖 介绍

当前支持的平台和类型：

| 平台       | 触发的消息形态                    | 视频 | 图集 | 音频 | 备注 |
| :--------- | :-------------------------------- | :--: | :--: | :--: | :--- |
| **B 站**   | av/BV号、链接、卡片                | ✅   | ✅   | ❌   | 支持分P、番剧、直播 |
| **小红书** | 链接、卡片                         | ✅   | ✅   | ❌   | 支持无水印图文/视频 |
| **网易云** | 链接、卡片                         | ❌   | ✅   | ✅   | 支持高品质音频下载 |
| **抖音**   | 链接                              | ✅   | ✅   | ❌   | 支持图文、视频、模态框链接 |
| **微博**   | 链接                               | ✅   | ✅   | ❌   | 支持多图、长文 |
| **快手**   | 链接                              | ✅   | ✅   | ❌   | |
| **NGA**    | 链接                              | ❌   | ✅   | ❌   | 支持主楼内容解析 |
| **YouTube**| 链接                              | ✅   | ❌   |  ❌   | 需配置代理 |
| **TikTok** | 链接                              | ✅   | ❌   | ❌   | 需配置代理 |
| **Twitter**| 链接                              | ✅   | ✅   | ❌   | 需配置代理 |
| **AcFun**  | 链接                              | ✅   | ❌   | ❌   | |

## ⚙️ 配置

请在 AstrBot 的插件配置面板查看并修改以下关键配置：

*   **启用平台**：勾选需要解析的平台。
*   **资源限制**：设置允许下载的最大文件大小（MB）和最大时长（分钟）。
*   **代理设置**：解析 YouTube/TikTok/Twitter 等平台时必填。
*   **Cookies**：B 站、抖音、NGA 等平台建议配置 Cookies 以获取更高画质或避免风控。

## 🎉 指令

|   指令   |         权限          |        说明        |
| :------: | :-------------------: |  :---------------: |
| 开启解析 |      ADMIN            |  开启当前会话的自动解析 |
| 关闭解析 |      ADMIN            |  关闭当前会话的自动解析 |

## 🧠 插件工作流程

当插件运行后，每一条消息的处理流程如下：

1.  **消息接收**  
    监听所有消息事件，获取消息链与原始文本内容。支持普通文本、链接、JSON 卡片（如小程序、音乐卡片）。

2.  **基础过滤**  
    - 跳过已被禁用的会话。
    - 跳过空消息。
    - 若消息为 `@` 其他 Bot，则不解析。

3.  **链接提取与匹配**  
    - 若为卡片消息，自动从 JSON 中提取跳转链接。
    - 使用「关键词 + 正则」双重匹配，定位对应解析器。

4.  **仲裁判定 (Emoji Like Arbiter)**  
    - 仅在 `aiocqhttp` (OneBot v11) 平台生效。
    - 通过 QQ 表情点赞机制进行多 Bot 间的无状态仲裁，防止多个 Bot 同时解析同一条链接。

5.  **防抖判定 (Link Debouncer)**  
    - 对同一会话内的相同链接进行时间窗口限制。
    - 避免因网络波动或用户重复发送导致的重复解析。

6.  **内容解析与下载**  
    - 调用对应平台解析器获取媒体信息。
    - 智能选择最优画质/音质。
    - 实时监控下载进度，若文件大小或时长超过限制，立即终止下载以节省资源。

7.  **消息构建与发送**  
    - 自动判断媒体类型（图片、视频、音频、文件）。
    - 智能合并：当解析结果包含多个媒体片段时，自动合并为转发消息发送，避免刷屏。

## 🧩 扩展

插件支持自定义解析器，通过继承 `BaseParser` 类并使用 `@handle` 装饰器注册即可轻松扩展新的平台支持。

## ⚠️ 免责声明

本插件仅供学习和技术交流使用，使用者应自行承担使用本插件产生的风险。
插件开发者不对任何因使用本插件而产生的直接或间接损失负责。
请勿将本插件用于任何非法用途，包括但不限于侵犯版权、网络攻击等。

## 🎉 致谢

[nonebot-plugin-parser](https://github.com/fllesser/nonebot-plugin-parser)

[astrbot_plugin_parser](https://github.com/Zhalslar/astrbot_plugin_parser)

[rconsole-plugin](https://github.com/zhiyu1998/rconsole-plugin)

